## Introduction
At the time of writing this module, Microsoft Active Directory holds around `43%` of the [market share](https://www.slintel.com/tech/identity-and-access-management/microsoft-active-directory-market-share#faqs) for enterprise organizations utilizing `Identity and Access management` solutions.
We can use a tool such as [linkedin2username](https://github.com/initstring/linkedin2username) to scrape data from a company's LinkedIn page and create various mashups of usernames

Our tasks to accomplish for this section are:
- Enumerate the internal network, identifying hosts, critical services, and potential avenues for a foothold.
- This can include active and passive measures to identify users, hosts, and vulnerabilities we may be able to take advantage of to further our access.
- Document any findings we come across for later use. Extremely important!

Kerbrute is good.

## LLMR/NBT-NS Poisoning from Linux
Man-In-The-Middle on Link-Local Multicaster Name Resolution (*LLMR/NBT*).
[Link-Local Multicast Name Resolution](https://datatracker.ietf.org/doc/html/rfc4795) (LLMNR) and [NetBIOS Name Service](https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-2000-server/cc940063\(v=technet.10\)?redirectedfrom=MSDN) (NBT-NS) are Microsoft Windows components that serve as alternate methods of host identification

1. A host attempts to connect to the print server at \\print01.inlanefreight.local, but accidentally types in \\printer01.inlanefreight.local.
2. The DNS server responds, stating that this host is unknown.
3. The host then broadcasts out to the entire local network asking if anyone knows the location of \\printer01.inlanefreight.local.
4. The attacker (us with `Responder` running) responds to the host stating that it is the \\printer01.inlanefreight.local that the host is looking for.
5. The host believes this reply and sends an authentication request to the attacker with a username and NTLMv2 password hash.
6. This hash can then be cracked offline or used in an SMB Relay attack if the right conditions exist.

With *NTLM* has we can take it and pass it into hashcat or use it in pth attacks. 
Responder and Metasploit can both do LLMR/NBT-NS Poisoning

Useful `Reponder` Flags
`-w wpad server (capture http requests using internet explorer)`
`-A analyze mode`
`-f fingerprint`

*Responder provides NLTMv2 hashes which can be cracked with hashcat -m 5600*

## NLTMNR/NBT-NS Poisoning - from Windows
We use the term Inveigh to capture credentials.
Works similiar to Responder but uses C# and Powershell

#### Using Inveigh (Powershell)
```powershell-session
PS C:\htb> Import-Module .\Inveigh.ps1
PS C:\htb> (Get-Command Invoke-Inveigh).Parameters
```
```powershell-session
Invoke-Inveigh Y -NBNS Y -ConsoleOutput Y -FileOutput Y
```

#### C# (Inveigh Zero)
```powershell-session
.\Inveigh.exe
```

We can quickly view unique captured hashes by typing `GET NTLMV2UNIQUE`.
We can type in `GET NTLMV2USERNAMES` and see which usernames we have collected.

## Password Spraying
[statistically-likely-usernames](https://github.com/insidetrust/statistically-likely-usernames)
### Enumerating The Password Policy - From Linux
```shell-session
crackmapexec smb 172.16.5.5 -u avazquez -p Password123 --pass-pol
```
