## Penetration Testing Overview
A `Penetration Test` (`Pentest`) is an organized, targeted, and authorized attack attempt to test IT infrastructure and its defenders to determine their susceptibility to IT security vulnerabilities. A pentest uses methods and techniques that real attackers use. As penetration testers, we apply various techniques and analyses to gauge the impact that a particular vulnerability or chain of vulnerabilities may have on the confidentiality, integrity, and availability of an organization's IT systems and data.

- `A pentest aims to uncover and identify ALL vulnerabilities in the systems under investigation and improve the security for the tested systems.`

Other assessments, such as a `red team assessment`, may be scenario-based and focus on only the vulnerabilities leveraged to reach a specific end goal

### Vulnerability assessments 
Is a generic term to include vulnerability and security assessments and are typically done with automated tools like Nessus, Qualys, OpenVAS

Pentesting is a mix of automated and manual testing.

### Testing Methods
#### External
Preformed as anonymous user over the internet with goal to gain access into internal network
#### Internal 
Preform pentest within corporate network.

### Types of Penetration Testing

| **Type**         | **Information Provided**                                                                                                                                                                                                                                              |
| ---------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `Blackbox`       | `Minimal`. Only the essential information, such as IP addresses and domains, is provided.                                                                                                                                                                             |
| `Greybox`        | `Extended`. In this case, we are provided with additional information, such as specific URLs, hostnames, subnets, and similar.                                                                                                                                        |
| `Whitebox`       | `Maximum`. Here everything is disclosed to us. This gives us an internal view of the entire structure, which allows us to prepare an attack using internal information. We may be given detailed configurations, admin credentials, web application source code, etc. |
| `Red-Teaming`    | May include physical testing and social engineering, among other things. Can be combined with any of the above types.                                                                                                                                                 |
| `Purple-Teaming` | It can be combined with any of the above types. However, it focuses on working closely with the defenders.                                                                                                                                                            |
## Laws and Regulations
| **Categories**                                                                            | **USA**                                                                                                                                                             | **Europe**                                                                                                                      | **UK**                                                                                                        | **India**                                                                                                           | **China**                                                                                                                                                                                                                                                                |
| ----------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| Protecting critical information infrastructure and personal data                          | [Cybersecurity Information Sharing Act](https://www.cisa.gov/resources-tools/resources/cybersecurity-information-sharing-act-2015-procedures-and-guidance) (`CISA`) | [General Data Protection Regulation](https://gdpr-info.eu/) (`GDPR`)                                                            | [Data Protection Act 2018](https://www.legislation.gov.uk/ukpga/2018/12/contents/enacted)                     | [Information Technology Act 2000](https://www.indiacode.nic.in/bitstream/123456789/13116/1/it_act_2000_updated.pdf) | [Cyber Security Law](https://digichina.stanford.edu/work/translation-cybersecurity-law-of-the-peoples-republic-of-china-effective-june-1-2017/)                                                                                                                          |
| Criminalizing malicious computer usage and unauthorized access to computer systems        | [Computer Fraud and Abuse Act](https://www.justice.gov/jm/jm-9-48000-computer-fraud) (`CFAA`)                                                                       | [Network and Information Systems Directive](https://www.enisa.europa.eu/topics/cybersecurity-policy/nis-directive-new) (`NISD`) | [Computer Misuse Act 1990](https://www.legislation.gov.uk/ukpga/1990/18/contents)                             | [Information Technology Act 2000](https://www.indiacode.nic.in/bitstream/123456789/13116/1/it_act_2000_updated.pdf) | [National Security Law](https://www.chinalawtranslate.com/en/2015nsl/)                                                                                                                                                                                                   |
| Prohibiting circumventing technological measures to protect copyrighted works             | [Digital Millennium Copyright Act](https://www.congress.gov/bill/105th-congress/house-bill/2281) (`DMCA`)                                                           | [Cybercrime Convention of the Council of Europe](https://www.europarl.europa.eu/cmsdata/179163/20090225ATT50418EN.pdf)          |                                                                                                               |                                                                                                                     | [Anti-Terrorism Law](https://web.archive.org/web/20240201044856/http://ni.china-embassy.gov.cn/esp/sgxw/202402/t20240201_11237595.htm)                                                                                                                                   |
| Regulating the interception of electronic communications                                  | [Electronic Communications Privacy Act](https://www.congress.gov/bill/99th-congress/house-bill/4952) (`ECPA`)                                                       | [E-Privacy Directive 2002/58/EC](https://eur-lex.europa.eu/legal-content/EN/ALL/?uri=CELEX%3A32002L0058)                        | [Human Rights Act 1998](https://www.legislation.gov.uk/ukpga/1998/42/contents) (`HRA`)                        | [Indian Evidence Act of 1872](https://legislative.gov.in/sites/default/files/A1872-01.pdf)                          |                                                                                                                                                                                                                                                                          |
| Governing the use and disclosure of protected health information                          | [Health Insurance Portability and Accountability Act](https://aspe.hhs.gov/reports/health-insurance-portability-accountability-act-1996) (`HIPAA`)                  |                                                                                                                                 | [Police and Justice Act 2006](https://www.legislation.gov.uk/ukpga/2006/48/contents)                          | [Indian Penal Code of 1860](https://legislative.gov.in/sites/default/files/A1860-45.pdf)                            |                                                                                                                                                                                                                                                                          |
| Regulating the collection of personal information from children                           | [Children's Online Privacy Protection Act](https://www.ftc.gov/legal-library/browse/rules/childrens-online-privacy-protection-rule-coppa) (`COPPA`)                 |                                                                                                                                 | [Investigatory Powers Act 2016](https://www.legislation.gov.uk/ukpga/2016/25/contents/enacted) (`IPA`)        |                                                                                                                     |                                                                                                                                                                                                                                                                          |
| A framework for cooperation between countries in investigating and prosecuting cybercrime |                                                                                                                                                                     |                                                                                                                                 | [Regulation of Investigatory Powers Act 2000](https://www.legislation.gov.uk/ukpga/2000/23/contents) (`RIPA`) |                                                                                                                     |                                                                                                                                                                                                                                                                          |
| Outlining individuals' legal rights and protections regarding their personal data         |                                                                                                                                                                     |                                                                                                                                 |                                                                                                               | [Personal Data Protection Bill 2019](https://www.congress.gov/bill/116th-congress/senate-bill/2889)                 | [Measures for the Security Assessment of Cross-border Transfer of Personal Information and Important Data](https://www.mayerbrown.com/en/perspectives-events/publications/2022/07/china-s-security-assessments-for-cross-border-data-transfers-effective-september-2022) |
| Outlining individuals' fundamental rights and freedoms                                    |                                                                                                                                                                     |                                                                                                                                 |                                                                                                               |                                                                                                                     | [State Council Regulation on the Protection of Critical Information Infrastructure Security](http://english.www.gov.cn/policies/latestreleases/202108/17/content_WS611b8062c6d0df57f98de907.html)                                                                        |

## Precautionary Measures during Penetration Tests
- Obtain written consent from the owner or authorized representative of the computer or network being tested.
- Conduct the testing within the scope of the consent obtained only and respect any limitations specified.
- Take measures to prevent causing damage to the systems or networks being tested.
- Do not access, use or disclose personal data or any other information obtained during the testing without permission.
- Do not intercept electronic communications without the consent of one of the parties to the communication.
- Do not conduct testing on systems or networks that are covered by the Health Insurance Portability and Accountability Act (HIPAA) without proper authorization.

## Penetration Testing Process
### Pentesting Stages
![[Penetration Testing Process.png]]
#### Pre Engagement
- `Non-Disclosure Agreement`
- `Goals`
- `Scope`
- `Time Estimation`
- `Rules of Engagement`
#### Information Gathering
Describe how we obtain information about components. Searching for information to find security gaps.
#### Exploitation 
Testing attacks against potential vectors.
#### Post Exploitation
Ensure that we have access to an exploited machine even when changes are made. 
Escalate privileges and look for sensitive explanation
Or move onto lateral movement.

#### Proof-Of-Concept
Document step by step on how we took over network, our goal is to paint a picture of how we compromised the network, this shows how each exploit works and efforts for remediation.
	Possible to create scripts to assist client in replicating the steps taken.

#### Post-Engagement 
Detailed documentation is prepared to help the Administrators and client understand severity of processes found. 
Hold a report meeting and sometimes deliver a presentation. 

|**Stage**|**Description**|
|---|---|
|`1. Pre-Engagement`|The first step is to create all the necessary documents in the pre-engagement phase, discuss the assessment objectives, and clarify any questions.|
|`2. Information Gathering`|Once the pre-engagement activities are complete, we investigate the company's existing website we have been assigned to assess. We identify the technologies in use and learn how the web application functions.|
|`3. Vulnerability Assessment`|With this information, we can look for known vulnerabilities and investigate questionable features that may allow for unintended actions.|
|`4. Exploitation`|Once we have found potential vulnerabilities, we prepare our exploit code, tools, and environment and test the webserver for these potential vulnerabilities.|
|`5. Post-Exploitation`|Once we have successfully exploited the target, we jump into information gathering and examine the webserver from the inside. If we find sensitive information during this stage, we try to escalate our privileges (depending on the system and configurations).|
|`6. Lateral Movement`|If other servers and hosts in the internal network are in scope, we then try to move through the network and access other hosts and servers using the information we have gathered.|
|`7. Proof-of-Concept`|We create a proof-of-concept that proves that these vulnerabilities exist and potentially even automate the individual steps that trigger these vulnerabilities.|
|`8. Post-Engagement`|Finally, the documentation is completed and presented to our client as a formal report deliverable. Afterward, we may hold a report walkthrough meeting to clarify anything about our testing or results and provide any needed support to personnel tasked with remediating our findings.|

## Pre-Engagement
Broken into 3 essential components
1. Scoping Questionaire
2. Pre-Engagement Meeting
3. Kick-off Meeting

NDA must be signed by all parties.

|   |   |
|---|---|
|`Unilateral NDA`|This type of NDA obligates only one party to maintain confidentiality and allows the other party to share the information received with third parties.|
|`Bilateral NDA`|In this type, both parties are obligated to keep the resulting and acquired information confidential. This is the most common type of NDA that protects the work of penetration testers.|
|`Multilateral NDA`|Multilateral NDA is a commitment to confidentiality by more than two parties. If we conduct a penetration test for a cooperative network, all parties responsible and involved must sign this document.|
Important to determine who has signatory authority and who are the first and second points of contact. 

###### Important Documents that need to be signed before testing

| **Document**                                                         | **Timing for Creation**                             |
| -------------------------------------------------------------------- | --------------------------------------------------- |
| `1. Non-Disclosure Agreement` (`NDA`)                                | `After` Initial Contact                             |
| `2. Scoping Questionnaire`                                           | `Before` the Pre-Engagement Meeting                 |
| `3. Scoping Document`                                                | `During` the Pre-Engagement Meeting                 |
| `4. Penetration Testing Proposal` (`Contract/Scope of Work` (`SoW`)) | `During` the Pre-engagement Meeting                 |
| `5. Rules of Engagement` (`RoE`)                                     | `Before` the Kick-Off Meeting                       |
| `6. Contractors Agreement` (Physical Assessments)                    | `Before` the Kick-Off Meeting                       |
| `7. Reports`                                                         | `During` and `after` the conducted Penetration Test |
Scoping questionnaire to be sent to client to determine scope:
- Internal Vulnerability Assessment 
- External Vulnerability Assessment
- Internal Penetration Test
- External Penetration Test
- Wireless Security Assessment
- Application Security Assessment
- Physical Security Assessment 
- Social Engineering Assessment
- Red Team Assessment
- Web Application Security Assessment

## Information Gathering
- Open-Source Intelligence
- Infrastructure Enumeration
- Service Enumeration
- Host Enumeration

### Osint
Possible to find credentials and API keys on the internet.
Misconfigured Github or other repos can give us access to private keys or 

## Vulnerability Assessment 
| **Analysis Type** | **Description**                                                                                                                                                                                                                                                                                                                                                         |
| ----------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `Descriptive`     | Descriptive analysis is essential in any data analysis. On the one hand, it describes a data set based on individual characteristics. It helps to detect possible errors in data collection or outliers in the data set.                                                                                                                                                |
| `Diagnostic`      | Diagnostic analysis clarifies conditions' causes, effects, and interactions. Doing so provides insights that are obtained through correlations and interpretation. We must take a backward-looking view, similar to descriptive analysis, with the subtle difference that we try to find reasons for events and developments.                                           |
| `Predictive`      | By evaluating historical and current data, predictive analysis creates a predictive model for future probabilities. Based on the results of descriptive and diagnostic analyses, this method of data analysis makes it possible to identify trends, detect deviations from expected values at an early stage, and predict future occurrences as accurately as possible. |
| `Prescriptive`    | Prescriptive analytics aims to narrow down what actions to take to eliminate or prevent a future problem or trigger a specific activity or process.                                                                                                                                                                                                                     |

## Exploitation
When we have found one or two exploits in our assessment we can then prioritize them for attack. Which attacks me prioritize depends on 
- Probability of Success
- Complexity
- Probability of Damage

Use NVD calculator for probability of success.

## Post-Exploitation
The `Post-Exploitation` stage aims to obtain sensitive and security-relevant information from a local perspective and business-relevant information that, in most cases, requires higher privileges than a standard user. This stage includes the following components:
- Evasive Testing
- Information Gathering
- Pillaging
- Vulnerability Assessment
- Privilege Escalation
- Persistence
- Data Exfiltration

### Evasive Testing
Testing is split into 3 separate categories
**`Evasive`**
**`Hybrid Evasive`**
**`Non-Evasive`**

It can often help if we run commands that their systems will detect as we can display that their current systems work and we can identify any blind spots.

- Information Gathering
- Persistence
	- Obtain persistence asap, sometimes before Information Gathering
- Vulnerability Escalation
- Privilege Escalation
- Data Exfil

| **Type of Information**               | **Security Regulation**                                         |
| ------------------------------------- | --------------------------------------------------------------- |
| Credit Card Account Information       | `Payment Card Industry` (`PCI`)                                 |
| Electronic Patient Health Information | `Health Insurance Portability and Accountability Act` (`HIPAA`) |
| Consumers Private Banking Information | `Gramm-Leach-Bliley` (`GLBA`)                                   |
| Government Information                | `Federal Information Security Management Act of 2002` (`FISMA`) |
## Lateral Movement
In this stage, we want to test how far we can move manually in the entire network and what vulnerabilities we can find from the internal perspective that might be exploited. In doing so, we will again run through several phases:

1. Pivoting
2. Evasive Testing
3. Information Gathering
4. Vulnerability Assessment
5. (Privilege) Exploitation
6. Post-Exploitation

### Pivoting 
Techniques that allow us to use the exploited host as a proxy allowing us to access other devices on the network. 

## Post Exploitation
### Cleanup
Once testing is concluded we need to perform any necessary cleanup.

### Documenting and Reporting
- An attack chain (in the event of full internal compromise or external to internal access) detailing steps taken to achieve compromise
- A strong executive summary that a non-technical audience can understand
- Detailed findings specific to the client's environment that include a risk rating, finding impact, remediation recommendations, and high-quality external references related to the issue
- Adequate steps to reproduce each finding so the team responsible for remediation can understand and test the issue while putting fixes in place
- Near, medium, and long-term recommendations specific to the environment
- Appendices which include information such as the target scope, OSINT data (if relevant to the engagement), password cracking analysis (if relevant), discovered ports/services, compromised hosts, compromised accounts, files transferred to client-owned systems, any account creation/system modifications, an Active Directory security analysis (if relevant), relevant scan data/supplementary documentation, and any other information necessary to explain a specific finding or recommendation further
### Post Remediation Testing
Go back in and test if the remediation has worked.


