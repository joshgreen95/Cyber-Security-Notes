## Local File Inclusion (LFI)
Many modern languages use parameters to pick the content to be displayed on the page.
The most common place to find ***LFI*** is in a template engine.
Templating engine displays a page that shows common static parts and then dynamically loads other content. 

We often see parameters like ***/index.php?page=about***, where `index.php` sets static content and pulls the dynamic content from `about.php`

### Examples of Vulnerable Code
a file could have content based on the user-specified input. a page may have a `?language` parameter. The parameter may change the directory the web app is being loaded from. 
If we have control over the path being loaded then we may be able to exploit the vulnerability, read other files and potentially reach RCE.

#### PHP
In PHP we may use the `include()` function to load a local or remote file. If the path is passed from a user controlled parameter without validation then its vulnerable to File Inclusion.
```php
if (isset($_GET['language'])) {
    include($_GET['language']);
}
```

#### NodeJS
Get Parameter passed direct to readFile function.
```javascript
if(req.query.language) {
    fs.readFile(path.join(__dirname, req.query.language), function (err, data) {
        res.write(data);
    });
}
```

Another Example where parameter is taken from URL path.
```js
app.get("/about/:language", function(req, res) {
    res.render(`/${req.params.language}/about.html`);
});
```

|**Function**|**Read Content**|**Execute**|**Remote URL**|
|---|:-:|:-:|:-:|
|**PHP**||||
|`include()`/`include_once()`|✅|✅|✅|
|`require()`/`require_once()`|✅|✅|❌|
|`file_get_contents()`|✅|❌|✅|
|`fopen()`/`file()`|✅|❌|❌|
|**NodeJS**||||
|`fs.readFile()`|✅|❌|❌|
|`fs.sendFile()`|✅|❌|❌|
|`res.render()`|✅|✅|❌|
|**Java**||||
|`include`|✅|❌|❌|
|`import`|✅|✅|✅|
|**.NET**||||
|`@Html.Partial()`|✅|❌|❌|
|`@Html.RemotePartial()`|✅|❌|✅|
|`Response.WriteFile()`|✅|❌|❌|
|`include`|✅|✅|✅|
## LFI 
### Basic LFI
URL Includes Language Parameter and is set to *es.php*
it may pull content from a different database table based on parameter or it may be loading an entirely different version of the WebApp.

If the web application is pulling a file we can then read `/etc/passwd` and `C:\Windows\boot.ini`
***REMEMBER NOT EVERYTHING IS LINUX, INFACT UNLIKELY TO BE LINUX***
### Path Traversal 
Earlier example uses absolute paths and would only work if it was used within a function without any additions. 

```php
include("./languages/" . $_GET['language']);
```

If we use `/etc/password` the end result would be `./languages//etc/password` and error out and lead to nowhere.
We have to traverse paths with `../`
We don't know what path we're in so use a lot of `../` if we attempt to `../` when we are in the system file it wont go anywhere.

Always try to find the minimum number of `../` when writing a report and you may also use it to calculate how many directories are from root
IE if its 3 we may be in `/var/www/html/`

### Filename Prefix
on some occasions our input may be appended to a different string to get a full filename 
```php
include("lang_" . $_GET['language']);
```
if our url is` www.website.com/index.php?language=en` the file wold be `lang_en`

if we use our previous example the final string would be `lang_/etc/passwd`
because of this we can add a prefix of `/` before our payload to bypass the filename and traverse directories.

### Append Extensions 
Another common example is when an extension is appended to the language parameter. 
```php
include($_GET['language'] . ".php");
```
our input would then have `.php` appended to it.
if we tried to read `/etc/passwd` then it would be `/etc/passwd.php` which doesnt exist.

### Second-Order Attacks
Occurs when websites may be insecurely pulling files from back-end server based on user-controlled parameters. 

If a website allows us to download our profile picture from `/profile/$username/profile`
we can then craft a malicious username and it may be possible to pull another local file rather than our image.
In this case we would be *Poisoning* a database with a malicious payload.


## Basic Bypasses
