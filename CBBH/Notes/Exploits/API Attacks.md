## Web Service vs. API

The terms `web service` and `application programming interface (API)` should not be used interchangeably in every case.

- Web services are a type of application programming interface (API). The opposite is not always true!
- Web services need a network to achieve their objective. APIs can achieve their goal even offline.
- Web services rarely allow external developer access, and there are a lot of APIs that welcome external developer tinkering.
- Web services usually utilize SOAP for security reasons. APIs can be found using different designs, such as XML-RPC, JSON-RPC, SOAP, and REST.
- Web services usually utilize the XML format for data encoding. APIs can be found using different formats to store data, with the most popular being JavaScript Object Notation (JSON).

##### Different API Standards
- `XML-RPC` uses XML for encoding/decoding the remote procedure call
- `JSON-RPC`Uses json to invoke functionality
- `SOAP (Simple Object Access Protocol)` type of XML 
- `RESTful (Representational State Transfer)` Uses JSON or XML (most common I've seen)

## Web  Service Description Language (WSDL)
XML based file that informs users of provided services/methods 
WSDL should not always be accessible. Developers may not want to expose it or expose it in an uncommon location (security through obscurity).
*Fuzzing may reveal the WSDL file*

WSDL files can be found in many forms, such as `/example.wsdl`, `?wsdl`, `/example.disco`, `?disco` etc. [DISCO](https://docs.microsoft.com/en-us/archive/msdn-magazine/2002/february/xml-files-publishing-and-discovering-web-services-with-disco-and-uddi) is a Microsoft technology for publishing and discovering Web Services.

### File Breakdown
[WSDL version 1.1](https://www.w3.org/TR/2001/NOTE-wsdl-20010315)
1. Definition: Root element name of webservice specified and all namespace declared.
2. Data Types: The data types to be used in message exchange
3. Messages: Defines Input and output operations Args to be mapped to methods
4. Operation: Defines available SOAP actions alongside each message
5. Port Type: Encapsulates all input/output messages into operation
6. Binding: Binds the operation to a particular port type
7. Service: Client makes a call to the web service through the name of the service specified

## SOAPAction Spoofing
SOAP messages towards a SOAP service should include both the operation and the related parameters.
If SOAP is using HTTP it is then allowed to use another header called `SOAPaction`. If web service only considers `SOAPaction` before determining the operation to execute it may be vulnerable to SOAPAction Spoofing.

Upon assessment of WSDL file the thing to pay attention to is the following:
```xml
<wsdl:operation name="ExecuteCommand">
<soap:operation soapAction="ExecuteCommand" style="document"/>
```
Here is a soap action called execute command.
```xml
<s:element name="ExecuteCommandRequest">
<s:complexType>
<s:sequence>
<s:element minOccurs="1" maxOccurs="1" name="cmd" type="s:string"/>
</s:sequence>
</s:complexType>
</s:element>
```
There is a cmd parameter. We can create a spoofer with python the parameter may check if we are on internal networks. Possible bypass is with SOAPAction spoofing.

- We specify _LoginRequest_ in `<soap:Body>`, so that our request goes through. This operation is allowed from the outside.
- We specify the parameters of _ExecuteCommand_ because we want to have the SOAP service execute a `whoami` command.
- We specify the blocked operation (_ExecuteCommand_) in the SOAPAction header

Using the body of an allowed request we can then spoof the action.

## Command Injection
[[CBBH/Notes/Exploits/Command Injection|Command Injection]]

## Exploiting xmlrpc.php
[[CBBH/Notes/Exploits/WordPress|WordPress]] 
```shell-session
"<methodCall><methodName>system.listMethods</methodName></methodCall>"
```

### Pingbacks
[pingback](https://wordpress.com/support/comments/pingbacks/) is a special type of comment thatâ€™s created when you link to another blog post, as long as the other blog is set to accept pingbacks.
- IP Disclosure - An attacker can call the `pingback.ping` method on a WordPress instance behind Cloudflare to identify its public IP. The pingback should point to an attacker-controlled host (such as a VPS) accessible by the WordPress instance.
- Cross-Site Port Attack (XSPA) - An attacker can call the `pingback.ping` method on a WordPress instance against itself (or other internal hosts) on different ports. Open ports or internal hosts can be identified by looking for response time differences or response differences.
- Distributed Denial of Service Attack (DDoS) - An attacker can call the `pingback.ping` method on numerous WordPress instances against a single target.

## Information Disclosure
We should spend a considerable time Fuzzing 
Bypass rate limits with the `HTTP-X-FORWARDED-FOR` header.

## AFE
[[CBBH/Cheat Sheets/File Upload Attacks|File Upload Attacks]]

## LFI
[[CBBH/Cheat Sheets/File Inclusion|File Inclusion]]

## XSS
[[XSS]]

## SSRF
[[CBBH/Notes/Exploits/Server-Side Attacks|Server-Side Attacks]]

## ReDoS
Attacker may be able to cause significant delay in API response by exploiting inefficiencies in REGEX.
Iterrative checks increase evaluation time.

## XXE
[[CBBH/Notes/Exploits/Web Attacks|Web Attacks]]
