## What is Authentication
###### Authentication
"Process of verifying a claim that a system entity or a system resource has a certain attribute value"
*Confirming an entity's identity ensuring they are who they claim to be*

###### Authorization 
"Approval that is granted to a system entity to access a system resource"

![[AuthVSAuth.png]]

Most Widespread Authentication method is login forms.

### Common Authentication Methods
3 major categories
- Knowledge-based authentication
	- Based on knowledge factors i.e. passwords, passphrases, pin and security questions
- Ownership-based authentication
	- Proof of id with physical object or device, phones, security tokens, authenticator 
- Inherence-based authentication
	- Based on something the user does, biometrics, fingerprints, voice
	- Effective as biometric traits tied to individual user

2FA involved multiple authentication methods.

## Attacks on Authentication

- Knowledge Based Authentication
	- Social Engineering
	- Data Breaches
	- Brute forcing

- Ownership Based Authentication
	- Vulnerable to physical attacks, Stealing/cloning(NFC Tag in public, Sim)
	- Cryptographic attacks on authentication algorithm

- Attacking Inherence-based Authentication
	- Most Secure
	- If a breach happens, someone cant change their fingerprint.

## Enumerating Users
Vulnerabilities arise when a web app responds differently to registered/valid and invalid inputs for authentication endpoints.
***Devs often overlook Enumeration Vectors assuming info such as usernames are not confidential***
Usernames can be considered confidential if they are the primary identifier required for authentication in web applications. 

### Theory
Protection against username ENUM can have impact on user experience, if a website reveals if a username exists it might help a user identify if they failed to type their username correctly. 

### Enumerating Users via differing error message 
Brute force via usernames SecList and Filter by error.

Web application might not change display method but may only preform database lookups for valid usernames. Measure difference in response time to enumerate valid usernames.

## Brute-Forcing Passwords
See the module on [[BruteForce]] 
***password reuse*** Is a problem
Password leaks enable users to use passwords from data leaks on another web app (Password Spraying).

Weak paswords easy to brute force.

## Brute-Forcing Password Reset Tokens
If a user forgets their password the website will send them a one-time reset token. 
Weak password tokens may be brute-forced or predicted

### Identifying Weak Reset Tokens
Generated when user requests password reset.
Weak password tokens, possibly 4 characters long can be brute-forced
Assuming there are people in the process off resetting their passwords we can try brute force all active reset requests. If we want to target a specific user we will need to request a password reset.

## Brute-Forcing 2FA
one of the most common implementations relies on users password and OTP.
If valid credentials are obtained prior we must then get passed 2FA.

If a OTP relies on a 4 digit passcode it will easily be Brute-Forceable by fuzzing
## Weak Brute-Force Protection
Common types of brute-force protection mechanisms are rate limits and CAPTCHAs
### Rate Limits
Prevent servers being overwhelmed and prevent brute-force attacks by limiting number of requests allowed within a specified time frame. 

If the server relies on a reverse proxy, load balancer or web caches, the requests source ip belongs to middle box and not the attacker. Rate limit should be applied to attacker so many work based on IP address. 

Some rate limiters rely on `X-Forwarded-for` header to source IP address.
Attacker can send arbitrary IPs in the `X-Forwarded-for` header to throw off any rate limits.
`Completely Automated Public Turing test to tell Computers and Humans Apart (CAPTCHA)`

Many AI tools exist to solve CAPTCHAs 

## Default Credentials
Many times people forget to change default credentials of programs or  routers.
Testing default credentials is a part of the OWASP testing guide.
Seclists has default creds, there are other resources.
https://github.com/scadastrangelove/SCADAPASS/

Google is good to search too.

## Vulnerable Password Reset
Generic *Security Questions* may be easily guessable with OSINT.
Possible to brute force *Security Questions* dependent on content.
IE. What City were you born in? Could just be brute-forced with a list of world cities (12000).

### Manipulating Password Reset
Potentially possible to manipulate a hidden parameter in the password reset function to reset password from another account.

Username could be contained in Seperate parameter. Important to check that web app checks that username matches on reset function.

## Authentication Bypass via Direct Access
### Direct Access
Most straightforward way is to directly request server content with authenticating.
Possible to request content when web server does not check is user is properly id'd

If we know the endpoint is /admin.php and the application relies solely on the login page for authentication we can just request data from endpoint directly.

```php
if(!$_SESSION['active']) {
	header("Location: index.php");
}
```
If session is not active user is redirected to index.php

This script redirects but does not protect against direct acces through curl or burp.

We can trick the browser into rendering the page by changing the status code in burp from 302 -> 200
In burp intercept response and change code.

## Authentication Bypass via Parameter Modification
Closely related to IDOR.

Whenever admin validation is part of URL parameters and providing a user id 
we can Brute-force ID or if we know admins use that .

## Attacking Session Tokens
Session tokens are identifiers a web app uses to identify users, and tokens.
### Brute Force Attack
If a session token has insufficient entropy we can brute-force it quite easily. 
If the token itself provides insufficient length then it will be appended and prepended onto the token whilst only a small part of the token is dynamic. 

Another vulnerability is if the session counter is incremental. It might be possible to hijack all past and future sessions.

### Session Fixation
Enables attacker to obtain victims valid  session. 
An app vulnerable to session fixing does not provide a new session token after a successful authentication.
An attacker may be able to convince a victim to use their session code and access their account. This will link the attackers session code to the victims username and password.

1. An attacker obtains a valid session token by authenticating to the web application. For instance, let us assume the session token is `a1b2c3d4e5f6`. Afterward, the attacker invalidates their session by logging out.
2. The attacker tricks the victim to use the known session token by sending the following link: `http://vulnerable.htb/?sid=a1b2c3d4e5f6`. When the victim clicks this link, the web application sets the `session` cookie to the provided value
3. The victim authenticates to the vulnerable web application. The victim's browser already stores the attacker-provided session cookie, so it is sent along with the login request. The victim uses the attacker-provided session token since the web application does not assign a new one.
4. Since the attacker knows the victim's session token `a1b2c3d4e5f6`, they can hijack the victim's session.

### Improper Session Timeout 
If a session token does not have a timeout interval defined then hijacked session tokens can be used indefinitely. 
